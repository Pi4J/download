# Update the APT Repository indices (Release & Package files)

name: pi4j-update-apt-repo

# Controls when the action will run. 
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# 
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checking 'main' branch of git repository
        uses: actions/checkout@v2
      - name: Get latest Docker image
        run: docker pull pi4j/pi4j-builder-repo:latest
      - name: Run build in Docker container
        env:
          PGP_PRIVATE_KEY: ${{ secrets.PGP_PRIVATE_KEY }}
        run: docker run -e PGP_PRIVATE_KEY='${{ secrets.PGP_PRIVATE_KEY }}' --rm --volume $(pwd):/build pi4j/pi4j-builder-repo:latest /bin/bash -c bin/build.sh
      - name: Display file tree
        run: tree
